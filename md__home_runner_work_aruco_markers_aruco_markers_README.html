<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>aruco_markers: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">aruco_markers
   &#160;<span id="projectnumber">1.1.6</span>
   </div>
   <div id="projectbrief">A compact Python package for handling ArUCo markers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p align="center"></p>
<p><img src="https://raw.githubusercontent.com/cmower/aruco_markers/master/doc/image/marker.png" alt="" width="60" align="right" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md18"></a>
aruco_markers</h1>
<p><a href="https://github.com/psf/black"><img src="https://img.shields.io/badge/code%20style-black-000000.svg" alt="Code style: black" style="pointer-events: none;" class="inline"/></a></p>
<p>The <code>aruco_markers</code> package is a compact Python toolkit designed to manage ArUCo markers. It serves as a streamlined interface for the OpenCV aruco module and offers a range of capabilities through both a command line interface and a simplified library interface. For more information, refer to the accompanying documentation.</p>
<ul>
<li>Code: <a href="https://github.com/cmower/aruco_markers">https://github.com/cmower/aruco_markers</a></li>
<li>Documentation: <a href="https://cmower.github.io/aruco_markers/">https://cmower.github.io/aruco_markers/</a></li>
<li>PyPI: <a href="https://pypi.org/project/aruco-markers/">https://pypi.org/project/aruco-markers/</a></li>
<li>Issues: <a href="https://github.com/cmower/aruco_markers/issues">https://github.com/cmower/aruco_markers/issues</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
Install</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
From PyPI</h2>
<div class="fragment"><div class="line">pip install aruco_markers</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
From source</h2>
<p>In a new terminal:</p><ol type="1">
<li>Clone repository:<ul>
<li>(ssh) <code>$ git clone git@github.com:cmower/aruco_markers.git</code>, or</li>
<li>(https) <code>$ git clone <a href="https://github.com/cmower/aruco_markers.git">https://github.com/cmower/aruco_markers.git</a></code></li>
</ul>
</li>
<li>Change directory: <code>$ cd aruco_markers</code></li>
<li>Ensure <code>pip</code> is up-to-date: <code>$ python -m pip install --upgrade pip</code></li>
</ol>
<ol type="1">
<li>Install from source: <code>$ pip install .</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md22"></a>
The &lt;tt&gt;aruco_markers&lt;/tt&gt; library</h1>
<p>All the functionality of the library can be accessed via</p>
<div class="fragment"><div class="line">import aruco_markers</div>
</div><!-- fragment --><p>Full documentation for all the classes/functions provided can be found <a href="https://cmower.github.io/aruco_markers/">here</a>.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Command line interface</h1>
<p>Several features of the library are exposed to the command line via the <code>aruco</code> command. When running these commands, several directories will be created. The top level directory is <code>~/aruco_markers_data</code>. All the data created by these commands are stored here, specified in the following sub-sections.</p>
<p>The available commands are</p><ul>
<li><code>collect</code>: Collect data with checkerboard to calibrate a camera.</li>
<li><code>calibrate</code>: Calibrate a camera.</li>
<li><code>generate</code>: Generate marker tags.</li>
<li><code>detect</code>: Detect marker poses from camera feed.</li>
<li><code>server</code>: Start a camera server.</li>
</ul>
<p>The use of these commands are described below. In addition, you can access the documentation for ecah command by appending <code>--help</code>. For example </p><div class="fragment"><div class="line">$ aruco generate --help</div>
<div class="line">usage: aruco generate [OPTIONS]</div>
<div class="line"> </div>
<div class="line">Generate marker tags.</div>
<div class="line"> </div>
<div class="line">optional arguments:</div>
<div class="line">  -h, --help            Show this help message and exit.</div>
<div class="line">  -d DICT, --dict DICT  The dictionary for the ArUCo marker. The default is &#39;DICT_ARUCO_ORIGINAL&#39;.</div>
<div class="line">  -i ID, --id ID        Identifier of the marker. It has to be a valid id in the specified dictionary. The default is &#39;100&#39;.</div>
<div class="line">  -s SIDEPIXELS, --sidepixels SIDEPIXELS</div>
<div class="line">                        Size of the ArUCo tag. The default is &#39;200&#39;.</div>
<div class="line">  -w WIDTH, --width WIDTH</div>
<div class="line">                        Width of the marker in millimeters. The default is &#39;50&#39;.</div>
<div class="line">  -p PAD, --pad PAD     Padding around marker in millimeters. The image is positioned on an A4 pdf. The default is &#39;20&#39;.</div>
<div class="line">  -l LABEL, --label LABEL</div>
<div class="line">                        Add an optional label to the marker. The default is &#39;&#39;.</div>
<div class="line">  --noshow              Display the marker. If unspecified the tag is shown.</div>
<div class="line">  --save                Save the marker. Tags are saved in ~/aruco_markers/tags; this directory is created when it does not already exist.</div>
<div class="line">  --addhalfmarks        Add marks at the half-way marks on the pdf. If unspecified no marks are added.</div>
</div><!-- fragment --><p>Similarly for each of the other commands.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Generating markers</h2>
<p>You can generate markers using the <code>aruco generate</code> command. When the <code>--save</code> flag is included in the command line input, the marker data is saved in the <code>~/aruco_markers_data/tags</code> directory. Two files are created, an image of the marker as a PNG and a printable PDF. The PDF includes the tag and meta information as human-readable text.</p>
<p>For example, try running </p><div class="fragment"><div class="line">$ aruco generate --dict DICT_ARUCO_ORIGINAL --id 100 --save --noshow</div>
</div><!-- fragment --><p>The expected output is as follows (note <code>HOMEDIR</code> will be relaced with what ever your home directory is set as).</p>
<div class="fragment"><div class="line">Created HOMEDIR/aruco_markers_data</div>
<div class="line">Created HOMEDIR/aruco_markers_data/tags</div>
<div class="line">Saved</div>
<div class="line">  HOMEDIR/aruco_markers_data/tags/marker_dict_DICT_ARUCO_ORIGINAL_id_100_sidepixels_200_borderbits_1_width_500_pad_20.png</div>
<div class="line">  HOMEDIR/aruco_markers_data/tags/marker_dict_DICT_ARUCO_ORIGINAL_id_100_sidepixels_200_borderbits_1_width_500_pad_20.pdf</div>
</div><!-- fragment --><p><em>Note</em>, if you have already run <code>aruco generate</code> before, then it is possible you will not see the lines acknowledging a directories creation (i.e. those starting with <code>Created</code>).</p>
<p>The PNG file created should match the marker displayed at the top of this readme, i.e. <a href="https://cmower.github.io/aruco_markers/marker.png">here</a>.</p>
<p>The full list of available dictionaries are as follows.</p>
<ul>
<li>DICT_4X4_50</li>
<li>DICT_4X4_100</li>
<li>DICT_4X4_250</li>
<li>DICT_4X4_1000</li>
<li>DICT_5X5_50</li>
<li>DICT_5X5_100</li>
<li>DICT_5X5_250</li>
<li>DICT_5X5_1000</li>
<li>DICT_6X6_50</li>
<li>DICT_6X6_100</li>
<li>DICT_6X6_250</li>
<li>DICT_6X6_1000</li>
<li>DICT_7X7_50</li>
<li>DICT_7X7_100</li>
<li>DICT_7X7_250</li>
<li>DICT_7X7_1000</li>
<li>DICT_ARUCO_ORIGINAL</li>
<li>DICT_APRILTAG_16h5</li>
<li>DICT_APRILTAG_25h9</li>
<li>DICT_APRILTAG_36h10</li>
<li>DICT_APRILTAG_36h11</li>
</ul>
<p>When creating markers, it's often the case you want to affix the printed marker onto an object. In such cases, knowing the mid-points of the rectangle is helpful, as manual measurements can be inaccurate. To simplify this process, you can use the <code>--addhalfmarks</code> flag in the <code>aruco generate</code> command while generating markers. The following is an example of how the output would look like when running this command.</p>
<p><img src="https://raw.githubusercontent.com/cmower/aruco_markers/master/doc/image/marker-with-mark.png" alt="" width="60%" align="center" class="inline"/> </p>
<h2><a class="anchor" id="autotoc_md25"></a>
Calibrating a camera</h2>
<p>Calibrating a camera can be performed using the <code>aruco collect</code> and <code>aruco calibrate</code> command. Running this command will take you through several steps in order to calibrate the camera.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
Prerequisites</h3>
<p>You will require a checkerboard to complete the calibration process. A good resource for getting printable checkerboards can be found <a href="https://markhedleyjones.com/projects/calibration-checkerboard-collection">here</a>. It is a good idea to attach the printed checkerboard to a flat surface.</p>
<p>You can also find a checkerboard in the <code>doc/</code> directory called <code>Checkerboard-A4-25mm-8x6.pdf</code>. This is a 8-by-6 checkerboard, where each square has length 25mm when printed on A4.</p>
<h3><a class="anchor" id="autotoc_md27"></a>
Collect data</h3>
<p><img src="https://raw.githubusercontent.com/cmower/aruco_markers/master/doc/image/checkerboard.png" alt="" width="60%" align="center" class="inline"/> </p>
<p>To gather data for calibration, execute the <code>aruco collect</code> command. When the checkerboard is detected correctly, a result similar to the one depicted in the above figure should appear. Press the ESC key to stop collecting data.</p>
<p>To obtain accurate estimated parameters from the calibration process, it is advisable to move the checkerboard to different depths and orientations on the screen. Keep in mind that a considerable amount of data could be collected, so make sure that your PC has sufficient storage capacity. The quantity of data required is uncertain, but collecting more data will generally result in more precise estimated parameters. Nevertheless, processing more data will take more time. Ensuring sufficient coverage of depths and orientations is important.</p>
<p>In this particular example, I used the <code>Checkerboard-A4-25mm-8x6.pdf</code> found in the <code>doc/</code> directory for the checkerboard. Since I am using my laptop's webcam, the camera index is <code>0</code> (which is the default value). I began the data collection process by executing the following command.</p>
<div class="fragment"><div class="line">$ aruco collect --width 8 --height 6 --squaresize 25</div>
</div><!-- fragment --><p>Run <code>$ aruco collect --help</code> if you need more clarity on the command line input variables.</p>
<p>You should expect terminal output similar to the following.</p>
<div class="fragment"><div class="line">$ aruco collect --width 8 --height 6 --squaresize 25</div>
<div class="line">Press ESC to quit.</div>
<div class="line">Created HOMEDIR/aruco_markers_data</div>
<div class="line">Created HOMEDIR/aruco_markers_data/calibrate</div>
<div class="line">Created HOMEDIR/aruco_markers_data/calibrate/CAMERANAME</div>
<div class="line">Data collection completed for the &#39;CAMERANAME&#39; camera.</div>
<div class="line">Data saved in HOMEDIR/aruco_markers_data/calibrate/CAMERANAME</div>
</div><!-- fragment --><p>In the above, <code>HOMEDIR</code> is your home directory, i.e. where ever <code>~/</code> is on you PC, and <code>CAMERANAME</code> is the camera name used for data collection. This should correspond to the camera you intend to calibrate (if you have more than one camera attached to your PC). Note the <code>CAMERANAME</code>, it will be required in the calibration step next.</p>
<p>All the raw images that contain the checkerboard are collected into a zip file called <code>data.zip</code>. You can run the collection process several times, and the new data is appended to the zip file (the collection <em>does not</em> overwrite previously collected data).</p>
<h3><a class="anchor" id="autotoc_md28"></a>
Calibrate camera</h3>
<p>Once you have collected data (as described in the previous section), you can directly perform the calibration. All you require is the name of the camera (this was ouput to the terminal during the data collection, see <code>CAMERANAME</code> in previous section).</p>
<p>In my example, I ran the following.</p>
<div class="fragment"><div class="line">$ aruco calibrate --cameraname CAMERANAME</div>
</div><!-- fragment --><p>The terminal output should look similar to the following.</p>
<div class="fragment"><div class="line">$ aruco calibrate --cameraname CAMERANAME</div>
<div class="line">Processing checkerboard images ...</div>
<div class="line">Loaded (1/60) checkerboard_cameraname_CAMERANAME_width_8_height_6_squaresize_25.0_stamp_UNIQUETIMESTAMP.png</div>
<div class="line">  Processing ... success!</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">Loaded (60/60) checkerboard_cameraname_CAMERANAME_width_8_height_6_squaresize_25.0_stamp_UNIQUETIMESTAMP.png</div>
<div class="line">  Processing ... success!</div>
<div class="line">Done!</div>
<div class="line">Calibrating camera ... done!</div>
<div class="line">Calibration took 1.0067 seconds</div>
<div class="line">Camera matrix:</div>
<div class="line"> [[617.49438628   0.         318.25186084]</div>
<div class="line"> [  0.         617.0481798  263.17630606]</div>
<div class="line"> [  0.           0.           1.        ]]</div>
<div class="line"> </div>
<div class="line">Distorion Cooeficients:</div>
<div class="line"> [[-3.22848626e-01  2.43430897e+00 -2.73404118e-04  3.06017375e-03</div>
<div class="line">  -7.64518705e+00]]</div>
<div class="line">Saved HOMEDIR/aruco_markers_data/calibrate/CAMERANAME/camera_parameters.dat</div>
<div class="line">Completed calibration successfully.</div>
</div><!-- fragment --><p>In the above, 60 files were successfully processed. <em>Note</em>, each file name is given a unique time stamp so files are not overwritten. The duration of the calibration process is reported and also the estimated parameters. You do not need to note these since they are saved in the <code>camera_parameters.dat</code> file.</p>
<p>If you have a lot of data and the processing is taking too long, you can downsample the data by specifying the <code>--maxfiles MAXFILES</code> flag. This will randomly sample <code>MAXFILES</code> files from the file names (uniform distribution) and then perform the calibration.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
View pose detection from a camera feed</h2>
<p><img src="https://raw.githubusercontent.com/cmower/aruco_markers/master/doc/image/marker_ex.png" alt="" width="60%" align="center" class="inline"/> </p>
<p>After calibrating a camera, you can use the <code>aruco detect</code> command to display the position of a marker. This function is primarily intended for debugging and serves as a demonstration of detector configuration. However, if the camera has not been calibrated beforehand, this command will throw an error.</p>
<p>When you run <code>aruco detect</code> you should see something similar to the figure above. I ran this example by running the following in terminal.</p>
<div class="fragment"><div class="line">$ aruco detect --dict DICT_4X4_50 --markerindex 0</div>
</div><!-- fragment --><p><em>Note</em>, the marker I use in this example has a length of 5cm. This information is required if you want to use the pose estimation.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Server</h2>
<p>You can run a server that will broadcast images to a UDP network. Simply run the following</p>
<div class="fragment"><div class="line">$ aruco server</div>
</div><!-- fragment --><p>Several listeners can recieve the feeds from this server. The information flow is as follows.</p>
<p><img src="https://raw.githubusercontent.com/cmower/aruco_markers/master/doc/image/server-overview.png" alt="" width="60%" align="center" class="inline"/> </p>
<p>To see this in action try running the example script <a href="https://github.com/cmower/aruco_markers/blob/master/example/server_listener.py">example/server_listener.py</a>. <b>Note</b>, this script can be run multiple times in separate terminals.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Marker pose estimation</h1>
<p>If you opt for the <code>aruco_markers</code> package, you can use the command line interface to produce tags and calibrate cameras. However, if you require additional features, you can customize the class/method structure available in the library. Several methods are provided to that enable you to easily load camera parameters, and estimate marker poses.</p>
<p>Please see the examples, that show how to implement a simple pose estimator into <a href="example/ros1_tf_publisher.py">ROS 1</a>/<a href="example/ros2_tf_publisher.py">ROS 2</a>. This example assumes you have calibrated your camera by running <code>aruco collect</code>, and <code>aruco calibrate</code> prior to running this script.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Build documentation</h1>
<p>The documentation is hosted <a href="https://cmower.github.io/aruco_markers/">here</a>. However, if you would like to build the documentation yourself, follow these steps.</p>
<p>In a new terminal:</p><ol type="1">
<li>Clone repository:<ul>
<li>(ssh) <code>$ git clone git@github.com:cmower/aruco_markers.git</code>, or</li>
<li>(https) <code>$ git clone <a href="https://github.com/cmower/aruco_markers.git">https://github.com/cmower/aruco_markers.git</a></code></li>
</ul>
</li>
<li>Change directory: <code>$ cd aruco_markers/doc</code></li>
<li>Generate the main page: <code>$ python gen_mainpage.py</code></li>
</ol>
<ol type="1">
<li>Install doxygen: <code>$ sudo apt install doxygen</code></li>
<li>Build documentation: <code>$ doxygen</code></li>
<li>View documentation:<ul>
<li>In a browser, open <code>html/index.html</code></li>
<li>Build pdf (requires LaTeX)<ul>
<li><code>$ cd latex</code></li>
<li><code>$ make</code></li>
<li>Open the file called <code>refman.pdf</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md33"></a>
Supported cameras</h1>
<p>Generally, any camera that is accessible by the OpenCV <code>VideoCapture</code> class is supported. Others include</p>
<ul>
<li>The <a href="https://www.stereolabs.com/zed-mini/">ZED-Mini</a> RGBD camera.</li>
</ul>
<h1><a class="anchor" id="autotoc_md34"></a>
Citing</h1>
<p>If you use <code>aruco_markers</code> in your work, please consider citing the following.</p>
<div class="fragment"><div class="line">@software{Mower2023</div>
<div class="line">  title = &quot;aruco_markers: A Compact Python Package for handling ArUCo markers&quot;,</div>
<div class="line">  author = &quot;Christopher E. Mower&quot;,</div>
<div class="line">  year = &quot;2023&quot;,</div>
<div class="line">  url = {https://github.com/cmower/aruco_markers},</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md35"></a>
Contributing</h1>
<p>If you have any issues with the library, or find inaccuracies in the documentation please <a href="https://github.com/cmower/aruco_markers/issues/new/choose">raise an issue</a>. I am happy to consider new features if you <a href="https://github.com/cmower/aruco_markers/fork">fork the library</a> and submit a pull request. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
